<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/pandasuite-bridge/lib/pandasuite-bridge.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }
        #status { font-size: 12px; color: #666; text-align: center; padding: 5px; }
        #status.loading { color: #f59e0b; }
        #status.success { color: #10b981; }
        #status.error { color: #ef4444; }
    </style>
</head>
<body>
<div id="status">En attente...</div>
<script>
var MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/fbnrw6wdqfu3yd2e0gkqha5qukf1jfas';

PandaBridge.init(function( ) {
    PandaBridge.listen('lancerAnalyse', function(args) {
        var params = args[0] || {};
        var status = document.getElementById('status');
        status.textContent = 'Analyse en cours...';
        status.className = 'loading';

        var payload = {
            latitude: params.latitude || '',
            longitude: params.longitude || '',
            ville: params.ville || '',
            composition: params.composition || '',
            duree: params.duree || '',
            mobilite: params.mobilite || '',
            type_scenario: params.type_scenario || '',
            pauses: params.pauses || '',
            mood: params.mood || '',
            nombre_personnes: params.nombre_personnes || ''
        };

        fetch(MAKE_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(function(response) { return response.text(); })
        .then(function(resultText) {
            status.textContent = 'Parcours re√ßu !';
            status.className = 'success';
            PandaBridge.send('onParcoursRecu', { parcours_json: resultText });
        })
        .catch(function(error) {
            status.textContent = 'Erreur: ' + error.message;
            status.className = 'error';
            PandaBridge.send('onError', { error_message: error.message });
        });
    });
});
</script>
</body>
</html>
